# SPDX-License-Identifier: AGPL-3.0-or-later
name: Docs Determinism

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  check-determinism:
    name: Verify Docs Determinism
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.24"

      - name: Build stagecraft binary
        run: go build -o stagecraft ./cmd/stagecraft

      - name: Add stagecraft to PATH
        run: |
          echo "$(pwd)" >> $GITHUB_PATH

      - name: Set up Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Build XRAY (debug)
        working-directory: ai.agent/rust/xray
        run: cargo build

      - name: Build AI context (Cortex)
        run: go run ./ai.agent/cmd/cortex context build --xray-bin ./ai.agent/rust/xray/target/debug/xray

      - name: Generate AI-Agent docs
        run: go run ./ai.agent/cmd/cortex context docs

      - name: Verify checksums
        run: |
          cd docs/generated/ai-agent
          shasum -a 256 -c CHECKSUMS.sha256
