# SPDX-License-Identifier: AGPL-3.0-or-later
#
# Stagecraft - Stagecraft is a Go-based CLI that orchestrates local-first development and scalable single-host to multi-host deployments for multi-service applications powered by Docker Compose.
#
# Copyright (C) 2025  Bartek Kus
#
# This program is free software licensed under the terms of the GNU AGPL v3 or later.
#
# See https://www.gnu.org/licenses/ for license details.
#
features:
  # Architecture & Documentation
  - id: ARCH_OVERVIEW
    title: "Architecture documentation and project overview"
    status: todo
    spec: "overview.md"
    owner: bart
    tests: []

  - id: DOCS_ADR
    title: "ADR process and initial decisions"
    status: todo
    spec: "adr/0001-architecture.md"
    owner: bart
    tests: []

  # Phase 0: Foundation
  - id: CORE_CONFIG
    title: "Config loading and validation"
    status: done
    spec: "core/config.md"
    owner: bart
    tests:
      - "pkg/config/config_test.go"

  - id: CLI_INIT
    title: "Project bootstrap command"
    status: done
    spec: "commands/init.md"
    owner: bart
    tests:
      - "internal/cli/commands/init_test.go"
      - "test/e2e/init_smoke_test.go"

  - id: CORE_LOGGING
    title: "Structured logging helpers"
    status: done
    spec: "core/logging.md"
    owner: bart
    tests:
      - "pkg/logging/logging_test.go"

  - id: CORE_EXECUTIL
    title: "Process execution utilities"
    status: done
    spec: "core/executil.md"
    owner: bart
    tests:
      - "pkg/executil/executil_test.go"

  - id: CLI_GLOBAL_FLAGS
    title: "Global flags (--env, --config, --verbose, --dry-run)"
    status: done
    spec: "core/global-flags.md"
    owner: bart
    tests:
      - "internal/cli/root_test.go"

  - id: CORE_BACKEND_REGISTRY
    title: "Backend provider registry system"
    status: done
    spec: "core/backend-registry.md"
    owner: bart
    tests:
      - "pkg/providers/backend/registry_test.go"

  - id: CORE_MIGRATION_REGISTRY
    title: "Migration engine registry system"
    status: done
    spec: "core/migration-registry.md"
    owner: bart
    tests:
      - "pkg/providers/migration/registry_test.go"

  - id: CORE_BACKEND_PROVIDER_CONFIG_SCHEMA
    title: "Provider-scoped backend configuration schema"
    status: done
    spec: "core/backend-provider-config.md"
    owner: bart
    tests:
      - "pkg/config/config_test.go"

  - id: PROVIDER_INTEGRATION_TERRAFORM
    title: "Terraform Integration Provider (Terraform Island)"
    status: todo
    group: providers
    depends_on:
      - TAXONOMY_CORE_TYPES
      - TAXONOMY_EXECUTION_LOCAL
    spec: "spec/providers/integration/terraform.md"
    description: "Run Terraform deterministically via ExecutionProvider and normalize outputs into HostRefs + Facts; does not parse/own Terraform resource graphs."

  - id: PROVIDER_INTEGRATION_TERRAFORM_OUTPUTS_CONTRACT
    title: "Terraform Outputs Contract: stagecraft_hosts normalization"
    status: todo
    group: providers
    depends_on:
      - PROVIDER_INTEGRATION_TERRAFORM
    spec: "spec/providers/integration/terraform.md"
    description: "Define and enforce the canonical Terraform output `stagecraft_hosts`; deterministic sorting and schema validation."

  - id: PROVIDER_INTEGRATION_TERRAFORM_DETERMINISTIC_RUNNER
    title: "Deterministic Terraform Runner (pinned version, sandbox, structured logs)"
    status: todo
    group: providers
    depends_on:
      - PROVIDER_INTEGRATION_TERRAFORM
    spec: "spec/providers/integration/terraform.md"
    description: "Terraform init/workspace/plan/apply/output via ExecutionProvider with pinned terraform version, sandbox workspace, redaction, and structured result capture."

  - id: PROVIDER_INTEGRATION_TERRAFORM_FACTS_HOSTREFS
    title: "Emit HostRefs and Facts from Terraform outputs"
    status: todo
    group: providers
    depends_on:
      - PROVIDER_INTEGRATION_TERRAFORM_OUTPUTS_CONTRACT
      - TAXONOMY_CORE_TYPES
    spec: "spec/providers/integration/terraform.md"
    description: "Normalize terraform output JSON into Stagecraft HostRef inventory and Fact records with deterministic serialization."

  # Phase 1: Provider Interfaces
  - id: PROVIDER_BACKEND_INTERFACE
    title: "BackendProvider interface definition"
    status: done
    spec: "core/backend-registry.md"
    owner: bart
    tests:
      - "pkg/providers/backend/backend_test.go"

  - id: PROVIDER_FRONTEND_INTERFACE
    title: "FrontendProvider interface definition"
    status: done
    spec: "providers/frontend/interface.md"
    owner: bart
    tests:
      - "pkg/providers/frontend/frontend_test.go"

  - id: PROVIDER_NETWORK_INTERFACE
    title: "NetworkProvider interface definition"
    status: done
    spec: "providers/network/interface.md"
    owner: bart
    tests:
      - "pkg/providers/network/registry_test.go"

  - id: PROVIDER_CLOUD_INTERFACE
    title: "CloudProvider interface definition"
    status: done
    spec: "providers/cloud/interface.md"
    owner: bart
    tests:
      - "pkg/providers/cloud/registry_test.go"

  - id: PROVIDER_CI_INTERFACE
    title: "CIProvider interface definition"
    status: done
    spec: "providers/ci/interface.md"
    owner: bart
    tests:
      - "pkg/providers/ci/registry_test.go"

  - id: PROVIDER_SECRETS_INTERFACE
    title: "SecretsProvider interface definition"
    status: done
    spec: "providers/secrets/interface.md"
    owner: bart
    tests:
      - "pkg/providers/secrets/registry_test.go"

  # Phase 2: Core Orchestration
  - id: CORE_PLAN
    title: "Deployment planning engine"
    status: done
    spec: "core/plan.md"
    owner: bart
    tests:
      - "internal/core/plan_test.go"

  - id: ENGINE_PLAN_ACTIONS
    title: "Engine Plan Actions and Inputs Schema"
    status: draft
    spec: "engine/plan-actions.md"
    owner: bart
    tests:
      - "pkg/engine/inputs/common_test.go"
      - "pkg/engine/inputs/build_test.go"
      - "pkg/engine/inputs/apply_compose_test.go"
      - "pkg/engine/inputs/health_check_test.go"
      - "pkg/engine/inputs/unmarshal_test.go"
    depends_on:
      - "CORE_PLAN"

  - id: CORE_ENV_RESOLUTION
    title: "Environment resolution and context"
    status: done
    spec: "core/env-resolution.md"
    owner: bart
    tests:
      - "internal/core/env/env_test.go"

  - id: CORE_STATE
    title: "State management (release history)"
    status: done
    spec: "core/state.md"
    owner: bart
    tests:
      - "internal/core/state/state_test.go"

  - id: CORE_STATE_TEST_ISOLATION
    title: "State test isolation for CLI commands"
    status: done
    spec: "core/state-test-isolation.md"
    owner: bart
    tests:
      - "internal/cli/commands/test_helpers.go"
      - "internal/cli/commands/deploy_test.go"
      - "internal/cli/commands/rollback_test.go"
      - "internal/cli/commands/releases_test.go"

  - id: CORE_STATE_CONSISTENCY
    title: "State durability and read-after-write guarantees"
    status: done
    spec: "core/state-consistency.md"
    owner: bart
    tests:
      - "internal/core/state/state_test.go"

  - id: CORE_COMPOSE
    title: "Docker Compose integration"
    status: done
    spec: "core/compose.md"
    owner: bart
    tests:
      - "internal/compose/compose_test.go"

  - id: CLI_PHASE_EXECUTION_COMMON
    title: "Shared phase execution semantics for deploy and rollback"
    status: done
    spec: "core/phase-execution-common.md"
    owner: bart
    tests:
      - "internal/cli/commands/phases_common_test.go"
      - "internal/cli/commands/deploy_test.go"

  # Phase 3: Local Development
  - id: CLI_DEV_BASIC
    title: "Basic stagecraft dev command that delegates to backend provider"
    status: done
    spec: "commands/dev-basic.md"
    owner: bart
    tests:
      - "internal/cli/commands/dev_test.go"
      - "test/e2e/dev_smoke_test.go"

  - id: CLI_DEV
    title: "stagecraft dev command (full feature set)"
    status: done
    spec: "commands/dev.md"
    owner: bart
    tests:
      - "internal/cli/commands/dev_test.go"
      - "test/e2e/dev_smoke_test.go"

  - id: DEV_MKCERT
    title: "mkcert integration for local HTTPS"
    status: done
    spec: "dev/mkcert.md"
    owner: bart
    tests:
      - "internal/dev/mkcert/generator_test.go"

  - id: DEV_HOSTS
    title: "/etc/hosts management"
    status: done
    spec: "dev/hosts.md"
    owner: bart
    tests:
      - "internal/dev/hosts/hosts_test.go"

  - id: DEV_TRAEFIK
    title: "Traefik dev config generation"
    status: done
    spec: "dev/traefik.md"
    owner: bart
    tests:
      - "internal/dev/traefik/generator_test.go"

  - id: DEV_COMPOSE_INFRA
    title: "Compose infra up/down for dev"
    status: done
    spec: "dev/compose-infra.md"
    owner: bart
    tests:
      - "internal/dev/compose/generator_test.go"
      - "internal/dev/compose/golden_test.go"

  - id: PROVIDER_BACKEND_ENCORE
    title: "Encore.ts BackendProvider implementation"
    status: done
    spec: "providers/backend/encore-ts.md"
    owner: bart
    tests:
      - "internal/providers/backend/encorets/encorets_test.go"

  - id: PROVIDER_BACKEND_GENERIC
    title: "Generic command-based BackendProvider implementation"
    status: done
    spec: "providers/backend/generic.md"
    owner: bart
    tests:
      - "internal/providers/backend/generic/generic_test.go"

  - id: PROVIDER_FRONTEND_GENERIC
    title: "Generic dev command FrontendProvider"
    status: done
    spec: "providers/frontend/generic.md"
    owner: bart
    tests:
      - "internal/providers/frontend/generic/generic_test.go"

  - id: DEV_PROCESS_MGMT
    title: "Process lifecycle management"
    status: done
    spec: "dev/process-mgmt.md"
    owner: bart
    tests:
      - "internal/dev/process/runner_test.go"

  # Phase 4: Provider Implementations
  - id: PROVIDER_NETWORK_TAILSCALE
    title: "Tailscale NetworkProvider implementation"
    status: done
    spec: "providers/network/tailscale.md"
    owner: bart
    tests:
      - "internal/providers/network/tailscale/tailscale_test.go"
      - "internal/providers/network/tailscale/registry_test.go"

  - id: PROVIDER_CLOUD_DO
    title: "DigitalOcean CloudProvider implementation"
    status: done
    spec: "providers/cloud/digitalocean.md"
    owner: bart
    tests:
      - "internal/providers/cloud/digitalocean/do_test.go"

  # Phase 5: Build and Deploy
  - id: CLI_BUILD
    title: "stagecraft build command"
    status: done
    spec: "commands/build.md"
    owner: bart
    tests:
      - "internal/cli/commands/build_test.go"

  - id: CLI_PLAN
    title: "Plan command (dry-run)"
    status: done
    spec: "commands/plan.md"
    owner: bart
    tests:
      - "internal/cli/commands/plan_test.go"
    depends_on:
      - "CORE_PLAN"
      - "CORE_CONFIG"
      - "CLI_DEPLOY"
      - "CLI_BUILD"

  - id: CLI_DEPLOY
    title: "Deploy command"
    status: done
    spec: "commands/deploy.md"
    owner: bart
    tests:
      - "internal/cli/commands/deploy_test.go"
      - "test/e2e/deploy_smoke_test.go"

  - id: CLI_ROLLBACK
    title: "stagecraft rollback command"
    status: done
    spec: "commands/rollback.md"
    owner: bart
    tests:
      - "internal/cli/commands/rollback_test.go"

  - id: DEPLOY_COMPOSE_GEN
    title: "Per-host Compose generation"
    status: done
    spec: "deploy/compose-gen.md"
    owner: bart
    tests:
      - "internal/deploy/compose_test.go"

  - id: DEPLOY_ROLLOUT
    title: "docker-rollout integration"
    status: done
    spec: "deploy/rollout.md"
    owner: bart
    tests:
      - "internal/deploy/rollout_test.go"

  # Phase 6: Migration System
  - id: MIGRATION_CONFIG
    title: "Migration config schema in stagecraft.yml"
    status: done
    spec: "migrations/config.md"
    owner: bart
    tests:
      - "pkg/config/config_test.go"

  - id: MIGRATION_INTERFACE
    title: "Migrator interface"
    status: done
    spec: "migrations/interface.md"
    owner: bart
    tests:
      - "pkg/migrations/interface_test.go"

  - id: MIGRATION_ENGINE_RAW
    title: "Raw SQL migration engine implementation"
    status: done
    spec: "providers/migration/raw.md"
    owner: bart
    tests:
      - "internal/providers/migration/raw/raw_test.go"

  - id: MIGRATION_CONTAINER_RUNNER
    title: "ContainerRunner interface"
    status: todo
    spec: "migrations/container-runner.md"
    owner: bart
    tests:
      - "pkg/migrations/runner_test.go"

  - id: MIGRATION_PRE_DEPLOY
    title: "Pre-deploy migration execution"
    status: todo
    spec: "migrations/pre-deploy.md"
    owner: bart
    tests:
      - "internal/deploy/migrations_test.go"

  - id: MIGRATION_POST_DEPLOY
    title: "Post-deploy migration execution"
    status: todo
    spec: "migrations/post-deploy.md"
    owner: bart
    tests:
      - "internal/deploy/migrations_test.go"

  - id: CLI_MIGRATE_BASIC
    title: "Basic stagecraft migrate command using registered migration engines"
    status: done
    spec: "commands/migrate-basic.md"
    owner: bart
    tests:
      - "internal/cli/commands/migrate_test.go"
      - "test/e2e/migrate_smoke_test.go"

  - id: CLI_MIGRATE_PLAN
    title: "stagecraft migrate plan command (dedicated)"
    status: todo
    spec: "commands/migrate-plan.md"
    owner: bart
    tests:
      - "internal/cli/commands/migrate_plan_test.go"

  - id: CLI_MIGRATE_RUN
    title: "stagecraft migrate run command (dedicated)"
    status: todo
    spec: "commands/migrate-run.md"
    owner: bart
    tests:
      - "internal/cli/commands/migrate_run_test.go"

  - id: CLI_RELEASES
    title: "stagecraft releases list/show commands"
    status: done
    spec: "commands/releases.md"
    owner: bart
    tests:
      - "internal/cli/commands/releases_test.go"

  # Phase 7: Infrastructure
  - id: CLI_INFRA_UP
    title: "stagecraft infra up command"
    status: done
    spec: "commands/infra-up.md"
    owner: bart
    tests:
      - "internal/cli/commands/infra_up_test.go"

  - id: CLI_INFRA_DOWN
    title: "stagecraft infra down command"
    status: todo
    spec: "commands/infra-down.md"
    owner: bart
    tests:
      - "internal/cli/commands/infra_down_test.go"

  - id: INFRA_HOST_BOOTSTRAP
    title: "Host bootstrap (Docker, Tailscale, etc.)"
    status: done
    spec: "infra/bootstrap.md"
    owner: bart
    tests:
      - "internal/infra/bootstrap/bootstrap_test.go"
      - "internal/infra/bootstrap/executor_ssh_test.go"

  - id: INFRA_VOLUME_MGMT
    title: "Volume management"
    status: todo
    spec: "infra/volumes.md"
    owner: bart
    tests:
      - "internal/infra/volumes_test.go"

  - id: INFRA_FIREWALL
    title: "Firewall configuration"
    status: todo
    spec: "infra/firewall.md"
    owner: bart
    tests:
      - "internal/infra/firewall_test.go"

  # Phase 8: Operations
  - id: CLI_STATUS
    title: "stagecraft status command"
    status: todo
    spec: "commands/status.md"
    owner: bart
    tests:
      - "internal/cli/commands/status_test.go"

  - id: CLI_LOGS
    title: "stagecraft logs command"
    status: todo
    spec: "commands/logs.md"
    owner: bart
    tests:
      - "internal/cli/commands/logs_test.go"

  - id: CLI_SSH
    title: "stagecraft ssh command"
    status: todo
    spec: "commands/ssh.md"
    owner: bart
    tests:
      - "internal/cli/commands/ssh_test.go"

  - id: CLI_SECRETS_SYNC
    title: "stagecraft secrets sync command"
    status: todo
    spec: "commands/secrets-sync.md"
    owner: bart
    tests:
      - "internal/cli/commands/secrets_sync_test.go"

  - id: PROVIDER_SECRETS_ENVFILE
    title: "Env file SecretsProvider"
    status: todo
    spec: "providers/secrets/envfile.md"
    owner: bart
    tests:
      - "internal/providers/secrets/envfile/envfile_test.go"

  - id: PROVIDER_SECRETS_ENCORE
    title: "Encore dev secrets SecretsProvider"
    status: todo
    spec: "providers/secrets/encore.md"
    owner: bart
    tests:
      - "internal/providers/secrets/encore/encore_test.go"

  # Phase 9: CI Integration
  - id: PROVIDER_CI_GITHUB
    title: "GitHub Actions CIProvider"
    status: todo
    spec: "providers/ci/github.md"
    owner: bart
    tests:
      - "internal/providers/ci/github/github_test.go"

  - id: CLI_CI_INIT
    title: "stagecraft ci init command"
    status: todo
    spec: "commands/ci-init.md"
    owner: bart
    tests:
      - "internal/cli/commands/ci_init_test.go"

  - id: CLI_CI_RUN
    title: "stagecraft ci run command"
    status: todo
    spec: "commands/ci-run.md"
    owner: bart
    tests:
      - "internal/cli/commands/ci_run_test.go"

  # Phase 10: Project Scaffold
  - id: CLI_INIT_TEMPLATE
    title: "Template system for stagecraft init"
    status: todo
    spec: "scaffold/templates.md"
    owner: bart
    tests:
      - "internal/scaffold/templates_test.go"

  - id: CLI_NEW
    title: "stagecraft new --template=platform"
    status: todo
    spec: "commands/new.md"
    owner: bart
    tests:
      - "internal/cli/commands/new_test.go"

  - id: CLI_ATTACH
    title: "stagecraft attach for existing projects"
    status: todo
    spec: "commands/attach.md"
    owner: bart
    tests:
      - "internal/cli/commands/attach_test.go"

  - id: TEMPLATE_PLATFORM
    title: "Platform template (embedded)"
    status: todo
    spec: "scaffold/platform-template.md"
    owner: bart
    tests:
      - "internal/scaffold/platform_test.go"

  - id: SCAFFOLD_STAGECRAFT_DIR
    title: ".stagecraft/ directory generation"
    status: todo
    spec: "scaffold/stagecraft-dir.md"
    owner: bart
    tests:
      - "internal/scaffold/dir_test.go"

  # Governance
  - id: GOV_CORE
    title: "Governance Core for v1"
    status: done
    spec: "governance/GOV_CORE.md"
    owner: bart
    tests:
      - "internal/tools/specschema/specschema_test.go"
      - "internal/tools/cliintrospect/cliintrospect_test.go"
      - "internal/tools/features/features_test.go"
      - "internal/governance/mapping/mapping_test.go"
      - "internal/tools/docs/docs_test.go"
      - "internal/tools/specvscli/diff_test.go"
    depends_on:
      - "CORE_STATE"
      - "CLI_PHASE_EXECUTION_COMMON"

  - id: GOV_CLI_EXIT_CODES
    title: "CLI exit code governance and standardization"
    status: todo
    spec: "governance/GOV_CLI_EXIT_CODES.md"
    owner: bart
    tests: []
    depends_on:
      - "GOV_CORE"

  - id: CLI_COMMIT_SUGGEST
    title: "stagecraft commit suggest command"
    status: done
    spec: "commands/commit-suggest.md"
    owner: bart
    tests:
      - "internal/cli/commands/commit_suggest_test.go"
    depends_on:
      - "GOV_CORE"

  - id: GOV_STATUS_ROADMAP
    title: "stagecraft status roadmap command"
    status: done
    spec: "commands/status-roadmap.md"
    owner: bart
    tests:
      - "internal/cli/commands/status_test.go"
      - "internal/tools/roadmap/phase_test.go"
      - "internal/tools/roadmap/stats_test.go"
      - "internal/tools/roadmap/generator_test.go"
    depends_on:
      - "GOV_CORE"
